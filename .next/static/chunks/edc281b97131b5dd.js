(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,95468,e=>{"use strict";let t=(0,e.i(75254).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],95468)},52754,e=>{"use strict";let t=(0,e.i(75254).default)("wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);e.s(["Wallet",()=>t],52754)},31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},29184,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(7471),s=e.i(32341),l=e.i(61911),i=e.i(75254);let d=(0,i.default)("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);var n=e.i(95468),c=e.i(52754),o=e.i(87316);let u=(0,i.default)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),m=(0,i.default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),x=(0,i.default)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var h=e.i(31278),p=e.i(75157);function f(){let{user:e}=(0,s.useAuth)(),[i,f]=(0,a.useState)([]),[y,b]=(0,a.useState)(null),[j,v]=(0,a.useState)(null),[N,k]=(0,a.useState)(!0),[w,_]=(0,a.useState)(""),[C,S]=(0,a.useState)(!1),[T,z]=(0,a.useState)(null);(0,a.useEffect)(()=>{e&&M()},[e]),(0,a.useEffect)(()=>{y&&q(y)},[y]);let M=async()=>{try{let{data:t,error:a}=await r.supabase.from("family_links").select(`
                    child_id,
                    profiles:child_id (id, full_name)
                `).eq("parent_id",e?.id);if(a)throw a;let s=t.map(e=>({id:e.profiles.id,full_name:e.profiles.full_name}));f(s),s.length>0&&!y&&b(s[0].id)}catch(e){console.error("Error fetching children:",e)}finally{k(!1)}},q=async e=>{try{let{data:t}=await r.supabase.from("expenses").select("amount, type").eq("user_id",e),a=t?.filter(e=>"expense"===e.type).reduce((e,t)=>e+Number(t.amount),0)||0,{data:s}=await r.supabase.from("tasks").select("status").eq("user_id",e),l=s?.filter(e=>"done"!==e.status).length||0,i=s?.filter(e=>"done"===e.status).length||0,d=s?.length||0,n=d>0?Math.round(i/d*100):0,c=new Date().toISOString().split("T")[0],{count:o}=await r.supabase.from("meals").select("*",{count:"exact",head:!0}).eq("user_id",e).gte("timestamp",`${c}T00:00:00`);v({totalExpenses:a,activeTasks:l,completionRate:n,mealsToday:o||0})}catch(e){console.error("Error fetching child stats:",e)}},E=async t=>{t.preventDefault(),S(!0),z(null);try{let{data:t,error:a}=await r.supabase.from("profiles").select("id, role").eq("full_name",w).eq("role","child").single();if(a||!t)throw Error("Child not found. Make sure the name is correct and they have a Child account.");let{error:s}=await r.supabase.from("family_links").insert([{parent_id:e?.id,child_id:t.id}]);if(s){if("23505"===s.code)throw Error("You are already linked to this child.");throw s}_(""),M()}catch(e){z(e.message)}finally{S(!1)}};return N?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsx)(h.Loader2,{className:"animate-spin text-primary",size:32})}):(0,t.jsxs)("div",{className:"space-y-8 animate-in fade-in duration-500",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("h2",{className:"text-3xl font-bold tracking-tight",children:"Parental Dashboard"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Monitor and manage your children's activities."})]}),(0,t.jsxs)("form",{onSubmit:E,className:"flex gap-2",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(m,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:16}),(0,t.jsx)("input",{type:"text",placeholder:"Child's username...",value:w,onChange:e=>_(e.target.value),className:"pl-9 pr-4 py-2 bg-card border border-border rounded-xl focus:ring-2 focus:ring-primary outline-none transition-all w-full md:w-64"})]}),(0,t.jsx)("button",{type:"submit",disabled:C||!w,className:"bg-primary text-primary-foreground p-2 rounded-xl hover:bg-primary/90 disabled:opacity-50 transition-colors",children:C?(0,t.jsx)(h.Loader2,{className:"animate-spin",size:20}):(0,t.jsx)(x,{size:20})})]})]}),T&&(0,t.jsx)("div",{className:"p-3 rounded-xl bg-destructive/10 text-destructive text-sm font-medium",children:T}),0===i.length?(0,t.jsxs)("div",{className:"bg-card border-2 border-dashed border-border rounded-3xl p-12 text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-primary/10 text-primary rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)(l.Users,{size:32})}),(0,t.jsx)("h3",{className:"text-xl font-bold mb-2",children:"No children linked yet"}),(0,t.jsx)("p",{className:"text-muted-foreground max-w-sm mx-auto",children:"Link your child's account using their username to start monitoring their tasks, expenses, and meals."})]}):(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[(0,t.jsxs)("div",{className:"lg:col-span-1 space-y-4",children:[(0,t.jsx)("h3",{className:"text-sm font-bold uppercase tracking-widest text-muted-foreground px-2",children:"Your Family"}),(0,t.jsx)("div",{className:"space-y-2",children:i.map(e=>(0,t.jsxs)("button",{onClick:()=>b(e.id),className:(0,p.cn)("w-full flex items-center justify-between p-4 rounded-2xl border transition-all group",y===e.id?"bg-primary border-primary text-primary-foreground shadow-lg shadow-primary/20":"bg-card border-border hover:border-primary/50 text-card-foreground"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:(0,p.cn)("w-10 h-10 rounded-xl flex items-center justify-center font-bold text-lg",y===e.id?"bg-primary-foreground/20":"bg-primary/10 text-primary"),children:e.full_name[0].toUpperCase()}),(0,t.jsx)("span",{className:"font-bold",children:e.full_name})]}),(0,t.jsx)(u,{size:18,className:(0,p.cn)("transition-transform group-hover:translate-x-1",y===e.id?"opacity-100":"opacity-0")})]},e.id))})]}),(0,t.jsx)("div",{className:"lg:col-span-3 space-y-8",children:y&&j&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsx)(g,{title:"Total Spent",value:(0,p.formatCurrency)(j.totalExpenses),icon:c.Wallet,color:"text-red-500 bg-red-500/10"}),(0,t.jsx)(g,{title:"Active Tasks",value:j.activeTasks.toString(),icon:n.CheckCircle2,color:"text-blue-500 bg-blue-500/10"}),(0,t.jsx)(g,{title:"Completion",value:`${j.completionRate}%`,icon:d,color:"text-emerald-500 bg-emerald-500/10"}),(0,t.jsx)(g,{title:"Meals Today",value:j.mealsToday.toString(),icon:o.Calendar,color:"text-amber-500 bg-amber-500/10"})]}),(0,t.jsxs)("div",{className:"bg-card rounded-3xl border border-border p-8 text-center",children:[(0,t.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Activity Log (Coming Soon)"}),(0,t.jsxs)("p",{className:"text-muted-foreground",children:["Detailed activity logging and reports for ",i.find(e=>e.id===y)?.full_name," will be available here."]})]})]})})]})]})}function g({title:e,value:a,icon:r,color:s}){return(0,t.jsxs)("div",{className:"bg-card p-6 rounded-3xl border border-border shadow-sm flex flex-col gap-4",children:[(0,t.jsx)("div",{className:(0,p.cn)("w-12 h-12 rounded-2xl flex items-center justify-center",s),children:(0,t.jsx)(r,{size:24})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground font-bold uppercase tracking-widest mb-1",children:e}),(0,t.jsx)("h4",{className:"text-2xl font-black tracking-tight",children:a})]})]})}var y=e.i(18566);function b(){let{profile:e,loading:r}=(0,s.useAuth)(),l=(0,y.useRouter)();return((0,a.useEffect)(()=>{!r&&e&&"parent"!==e.role&&l.push("/")},[e,r,l]),r||e&&"parent"!==e.role)?null:(0,t.jsx)(f,{})}e.s(["default",()=>b],29184)}]);